{# app/templates/push_summary.html #}
{% extends "base.html" %}

{% block content %}
  <div class="container" style="max-width:700px; margin-top:2rem;">

    {# ─── Errors Card ──────────────────────────────────────────────── #}
    {% if errors %}
      <div class="card" style="border-color: #d9534f; padding:1rem; margin-bottom:2rem;">
        <h2 style="color:#d9534f; margin-bottom:1rem;">Errors</h2>
        <ul style="list-style:disc inside; color:#f2dede;">
          {% for err in errors %}
            <li style="margin:.5rem 0;">{{ err }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <div class="card" style="padding:2rem; text-align:center;">

      <h1 style="margin-bottom:1rem;">
        Pushed to Dgraph
      </h1>

      <p style="margin-bottom:2rem;">
        Submission <strong>{{ submission.name }}</strong>
      </p>

      <div style="text-align:left; margin:0 auto; max-width:600px;">

        <h2>
          Members <small>({{ members|length }})</small>
        </h2>
        {% if members %}
          <ul style="list-style:disc inside; margin-bottom:1.5rem;">
            {% for m in members %}
              <li>{{ m.businessName }} &rarr; <code>{{ m.memberID or m.uid }}</code></li>
            {% endfor %}
          </ul>
        {% else %}
          <p><em>No new members created.</em></p>
        {% endif %}

        <h2>
          Products <small>({{ products|length }})</small>
        </h2>
        {% if products %}
          <ul style="list-style:disc inside; margin-bottom:1.5rem;">
            {% for p in products %}
              <li>
                {{ p.title }}
                {% if p.note %}
                  <small style="color: #888;">({{ p.note }})</small>
                {% endif %}
                {% if p.productID and not p.productID.startswith('new_product_') %}
                  &rarr; <code>{{ p.productID }}</code>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p><em>No new products created.</em></p>
        {% endif %}

        <h2>
          Ingredients <small>({{ ingredients|length }})</small>
        </h2>
        {% if ingredients %}
          <ul style="list-style:disc inside; margin-bottom:1.5rem;">
            {% for i in ingredients %}
              <li>
                {{ i.title }}
                {% if i.note %}
                  <small style="color: #888;">({{ i.note }})</small>
                {% endif %}
                {% if i.ingredientID and not i.ingredientID.startswith('new_ingredient_') %}
                  &rarr; <code>{{ i.ingredientID }}</code>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p><em>No new ingredients created.</em></p>
        {% endif %}

      </div>

      <div style="display: flex; gap: 1rem; justify-content: center; margin-top:2rem; flex-wrap: wrap;">
        <a href="{{ url_for('main.download_processed_rows_csv', submission_id=submission.id) }}" class="btn accent">
          <i class="mdi mdi-download"></i> Processed Rows CSV
        </a>
        <a href="{{ url_for('main.download_errors_csv', submission_id=submission.id) }}" class="btn accent">
          <i class="mdi mdi-alert-circle"></i> Errors CSV
        </a>
        <a href="{{ url_for('main.download_created_nodes_csv', submission_id=submission.id) }}" class="btn accent">
          <i class="mdi mdi-plus-circle"></i> Created Nodes CSV
        </a>
        <a href="{{ url_for('main.download_all_reports', submission_id=submission.id) }}" class="btn primary">
          <i class="mdi mdi-archive"></i> All Reports (ZIP)
        </a>
        <a href="{{ url_for('main.upload_file') }}" class="btn">
          <i class="mdi mdi-arrow-left"></i> Back to Upload
        </a>
      </div>
      
      {% if operation_id %}
      <div style="margin-top: 1rem; padding: 1rem; background: rgba(74, 124, 89, 0.1); border-radius: 6px; border: 1px solid rgba(74, 124, 89, 0.3); text-align: center;">
        <p style="margin: 0; color: var(--primary); font-size: 0.9rem;">
          <i class="mdi mdi-information"></i>
          <strong>Operation ID:</strong> {{ operation_id }} - Use this ID to track logs and troubleshoot issues
        </p>
      </div>
      {% endif %}

    </div>
  </div>
{% endblock %}
